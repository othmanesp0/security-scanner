version: '3.8'

services:
  security-scanner:
    build: .
    container_name: security-scanner-dashboard
    ports:
      - "8080:80"
    volumes:
      - scanner_results:/var/www/html/results
      - scanner_logs:/var/www/html/logs
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=security_scanner
      - MYSQL_USER=scanner_user
      - MYSQL_PASSWORD=scanner_pass
    restart: unless-stopped
    networks:
      - scanner_network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.scanner.rule=Host(`scanner.localhost`)"
      - "traefik.http.services.scanner.loadbalancer.server.port=80"

  mysql:
    image: mysql:8.0
    container_name: security-scanner-db
    environment:
      - MYSQL_ROOT_PASSWORD=rootpassword
      - MYSQL_DATABASE=security_scanner
      - MYSQL_USER=scanner_user
      - MYSQL_PASSWORD=scanner_pass
    volumes:
      - scanner_db:/var/lib/mysql
      - ./database/schema.sql:/docker-entrypoint-initdb.d/schema.sql
    restart: unless-stopped
    networks:
      - scanner_network

volumes:
  scanner_db:
  scanner_results:
  scanner_logs:

networks:
  scanner_network:
    driver: bridge
